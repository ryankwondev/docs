# Mutual Verification Token (MVT) - 고도화된 인증 방식

## 1. 핵심 개념
- 서버와 클라이언트는 대칭 키를 동적으로 관리하며, 키의 무결성과 안전성을 보장하기 위해 여러 계층의 인증 및 키 교환 프로토콜을 적용.
- 단기 대칭 키뿐 아니라, **세션 상태를 유사하게 재구성 가능한 무상태 접근 방식**으로 설계.
- 키 갱신은 자동화된 프로세스를 기반으로 하되, **안정적인 복구 메커니즘**을 제공.

---

## 2. 동작 방식

### 초기 설정 및 키 교환
1. **로그인 및 초기 키 교환**:
   - 클라이언트가 로그인 시, 서버와 클라이언트는 **Diffie-Hellman 키 교환** 또는 **ECDH (Elliptic Curve Diffie-Hellman)**를 통해 초기 대칭 키(Shared Secret)를 생성.
   - 서버는 생성된 키에 대한 파생 데이터(예: Key ID)를 저장하고, 이를 클라이언트에 전송.

2. **대칭 키 파생**:
   - 초기 키에서 **HMAC-based Extract-and-Expand Key Derivation Function (HKDF)**을 사용하여 다수의 세션 키를 파생.
   - 각 요청마다 사용할 키는 **Timestamp** 및 요청 횟수에 기반하여 동적으로 생성.

### 요청 인증
3. **서명 생성 및 요청**:
   - 클라이언트는 요청 데이터를 대칭 키로 서명하여 함께 전송.
   - 서명 구조는 다음을 포함:
     - 요청 데이터의 HMAC
     - 요청 고유의 Nonce 또는 Timestamp
     - Key ID

4. **서버 측 검증**:
   - 서버는 요청에서 Key ID를 확인하고 해당 대칭 키를 복구.
   - 복구된 키로 서명을 검증하여 요청의 무결성과 인증을 확인.

### 키 갱신 및 관리
5. **주기적 키 갱신**:
   - 키는 요청 횟수나 시간이 초과되면 자동으로 만료되며, **새로운 키를 기존 키로 암호화하여 교환**.
   - 갱신된 키는 클라이언트와 서버에서 동기화되며, 기존 키가 중단되기 전 안전하게 전달.

6. **키 분실 복구**:
   - 클라이언트가 키를 분실하거나 동기화가 실패할 경우, **비대칭 암호화를 통한 복구 프로세스** 적용:
     - 클라이언트는 서버의 공개 키로 암호화된 복구 요청 전송.
     - 서버는 초기 공유 키 또는 복구용 비밀 키로 새로운 대칭 키를 생성 및 전송.

---

## 3. 추가적인 보안 강화
- **키 재사용 방지**:
  - 각 요청마다 새로운 Nonce와 Timestamp를 사용하여 **재전송 공격(MITM, Replay)**을 방지.
  - Nonce는 서버에서 기록하여 중복 요청을 차단.

- **다중 알고리즘 사용**:
  - HMAC-SHA256 또는 AES-GCM 같은 강력한 대칭 암호화 알고리즘 사용.
  - 만약 대칭 키가 노출되더라도, 세션 키는 Key Derivation을 통해 독립적으로 동작.

- **Fail-Safe 타임아웃**:
  - 키의 유효 시간이 지나거나 요청 횟수가 초과되면 자동으로 만료.
  - 서버는 타임아웃된 키를 명시적으로 폐기하고 클라이언트가 재인증하도록 유도.

---

## 4. 장점
1. **보안성 강화**:
   - 동적 키 생성 및 주기적 갱신으로 키 노출 위험 감소.
   - Replay 및 MITM 공격에 대한 강력한 방어.

2. **확장성**:
   - 대칭 키 기반으로 경량화된 구조 유지.
   - 키 갱신과 요청 검증이 병렬로 가능하여 대규모 트래픽을 효율적으로 처리.

3. **관리 편의성**:
   - 키 분실 복구 프로세스를 통해 안정적인 동작 보장.
   - 키의 상태를 중앙 집중적으로 관리할 필요가 없음.

---

## 5. 단점 및 해결 방안
1. **키 동기화 실패 가능성**:
   - 해결: 타임아웃과 비대칭 키 기반 복구 프로세스로 신속 복구.

2. **복잡성 증가**:
   - 해결: SDK나 라이브러리를 통해 클라이언트 구현의 복잡성을 추상화.

3. **추가적인 리소스 소비**:
   - 해결: HKDF와 대칭 암호화를 경량화된 방식으로 구현.

---

## 6. 적용 사례
- **IoT 장치**:
  - 제한된 리소스를 가진 디바이스에 적합. 대칭 키 암호화를 통해 최소한의 처리 비용으로 보안 유지.

- **마이크로서비스 아키텍처**:
  - 분산 환경에서 개별 서비스 간 신뢰를 구축.

- **고속 API 요청 처리**:
  - 빠른 요청 인증이 필요한 금융 및 통신 시스템에서 활용 가능.

---

이 설계는 기존 MVT 방식에서 키 갱신 및 복구 메커니즘을 포함하여 더 견고하고 실용적인 인증 체계를 제공합니다.
